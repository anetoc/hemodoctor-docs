# 12_output_policies_hybrid.yaml
# Output Policies e Render Final - ALWAYS-OUTPUT DESIGN
# Integra√ß√£o SADMH V2.3 Always-Output Design + Valida√ß√£o Externa
# Vers√£o: v2.3.1
# Data: 2025-10-19
# Maestro final: integra missingness + next_steps_engine + confidence + render

version: output_policies_hybrid_v2.3.1
module: output_orchestrator

description: |
  M√≥dulo final do pipeline que orquestra o card de sa√≠da.
  
  **Filosofia Always-Output:**
  - SEMPRE gera um card √∫til (never empty, never blocking)
  - Integra com m√≥dulo 05 (missingness) e 09 (next_steps_engine)
  - Mapeia confidence (C0/C1/C2) com explica√ß√µes claras
  - Renderiza em formatos m√∫ltiplos (markdown/HTML/JSON)
  
  **Pipeline completo:**
  00_config ‚Üí 01_schema ‚Üí 02_evidence ‚Üí 03_syndromes ‚Üí 05_missingness ‚Üí 
  06_route_policy ‚Üí 09_next_steps ‚Üí **12_output_policies** ‚Üí Card Final

# =============================================================================
# SE√á√ÉO 1: SELE√á√ÉO DE CARD (HIERARQUIA)
# =============================================================================
card_selection:
  description: "Hierarquia de sele√ß√£o garantida (rota √∫nica determin√≠stica)"
  
  hierarchy:
    - priority: 1
      name: critical
      condition: "any_critical_syndrome_true"
      syndromes: [S-NEUTROPENIA-GRAVE, S-BLASTIC-SYNDROME, S-TMA, S-PLT-CRITICA, 
                  S-ANEMIA-GRAVE, S-NEUTROFILIA-LEFTSHIFT-CRIT, S-THROMBOCITOSE-CRIT, 
                  S-CIVD, S-APL-SUSPEITA]
      render: "render_critical_card"
    
    - priority: 2
      name: review_sample
      condition: "preanalytical_flags_present"
      syndromes: [S-REVIEW-SAMPLE]
      triggers:
        - "mchc > 37.0"
        - "morphology.aglomerados_plaquetarios == true"
        - "(plt < 100) AND (mpv > 12)"
      render: "render_review_sample_card"
    
    - priority: 3
      name: priority
      condition: "any_priority_syndrome_true"
      syndromes: [S-IDA, S-IDA-INFLAM, S-BETA-THAL, S-ALFA-THAL, S-ACD, 
                  S-MACRO-B12-FOLATE, S-HEMOLYSIS, S-APLASIA-RETIC-LOW, 
                  S-MDS, S-MM-MGUS, S-PNH, S-HB-SICKLE, S-LYMPHOPROLIFERATIVE, 
                  S-EOSINOPHILIA, S-CML, S-MPN-POSSIBLE, S-PTI, S-HIT-POSSIBLE, 
                  S-PSEUDO-THROMBO, S-THROMBOCITOSE, S-PANCYTOPENIA, 
                  S-LEUCOERITROBLASTOSE, S-POLICITEMIA, S-MONOCITOSE-CRONICA, 
                  S-BASOFILIA, S-EVANS]
      render: "render_priority_card"
    
    - priority: 4
      name: borderline
      condition: "borderline_values_present"
      triggers:
        - "(mcv >= 80 AND mcv < 82) OR (mcv > 98 AND mcv <= 100)"
        - "(plt >= 140 AND plt < 150) OR (plt > 450 AND plt < 500)"
        - "(wbc >= 3.8 AND wbc < 4) OR (wbc > 11 AND wbc < 12)"
        - "(sex == 'F' AND hb >= 11.5 AND hb < 12) OR (sex == 'M' AND hb >= 12.5 AND hb < 13)"
      render: "render_routine_borderline_card"
    
    - priority: 5
      name: routine
      condition: "no_syndromes AND no_borderline"
      render: "render_routine_normal_card"
    
    - priority: 6
      name: abstain_with_guidance
      condition: "missing_rate > 0.30 AND no_critical_syndrome"
      render: "render_c0_guidance_card"

# =============================================================================
# SE√á√ÉO 2: TEMPLATES DE CARD
# =============================================================================
card_templates:
  
  # ---------------------------------------------------------------------------
  # CRITICAL CARD
  # ---------------------------------------------------------------------------
  critical:
    header: |
      # üö® CR√çTICO: {syndrome_names}
      **Confidence:** {confidence} | **Urg√™ncia:** Imediata | **Route ID:** `{route_id}`
    
    body_sections:
      - section: evidence_summary
        title: "## Evid√™ncias Disparadas"
        content: |
          {evidence_trail}
          
          **Valores-chave cr√≠ticos:**
          {key_values_table}
      
      - section: rationale
        title: "## Justificativa Cl√≠nica"
        content: |
          {syndrome_rationale}
          
          **Padr√£o hematim√©trico:** {pattern_description}
      
      - section: actions_urgent
        title: "## ‚ö° A√ß√µes Urgentes Obrigat√≥rias"
        content: |
          {urgent_actions_list}
          
          **Timeframe:** {expected_timeframe}
      
      - section: next_steps
        title: "## Pr√≥ximos Passos (priorit√°rios)"
        content: |
          {next_steps_from_module_09}
      
      - section: missing_keys
        title: "## ‚ö†Ô∏è Campos Cr√≠ticos Ausentes"
        content: |
          {missing_fields_list}
          
          **Impacto na decis√£o:** {missing_impact}
    
    footer: |
      ---
      **Sistema:** HemoDoctor Hybrid V1.0  
      **Timestamp:** {timestamp_utc}  
      **Route ID:** `{route_id}` (sha256)  
      **WORM Log:** Ver m√≥dulo 08 para auditoria completa
    
    render_options:
      highlight_color: "#FF0000"
      alert_sound: true
      notification: "urgent"
      email_escalation: true
      # NOVO v2.3.1 ‚Äî Incluir leucostase e APL suspeita
      sms_escalation_if: "anc < 0.2 OR plt < 10 OR wbc >= 100 OR apl_suspect == true"
  
  # ---------------------------------------------------------------------------
  # REVIEW SAMPLE CARD
  # ---------------------------------------------------------------------------
  review_sample:
    header: |
      # üîÑ REVER AMOSTRA
      **Motivo:** Erro pr√©-anal√≠tico suspeito | **Urg√™ncia:** Alta | **Route ID:** `{route_id}`
    
    body_sections:
      - section: pre_analytical_flags
        title: "## Flags Pr√©-Anal√≠ticos Detectados"
        content: |
          {preanalytical_flags_list}
          
          **Valores suspeitos:**
          {suspicious_values_table}
      
      - section: recoleta_instructions
        title: "## üìã Instru√ß√µes de Recoleta"
        content: |
          {recoleta_protocol}
          
          **Tubo recomendado:** {tube_type}
          **Tempo de transporte:** {transport_time}
          **Temperatura:** {temperature_control}
      
      - section: rationale
        title: "## Por Que Rever?"
        content: |
          {rationale_for_review}
    
    footer: |
      ---
      **A√ß√£o obrigat√≥ria:** N√ÉO liberar resultado atual at√© confirma√ß√£o.  
      **Timestamp:** {timestamp_utc}  
      **Route ID:** `{route_id}`
    
    render_options:
      highlight_color: "#FFA500"
      alert_sound: false
      notification: "standard"
      block_result_release: true
  
  # ---------------------------------------------------------------------------
  # PRIORITY CARD
  # ---------------------------------------------------------------------------
  priority:
    header: |
      # ‚ö†Ô∏è PRIORIDADE: {top3_syndromes}
      **Confidence:** {confidence} | **Route ID:** `{route_id}`
    
    body_sections:
      - section: syndrome_summary
        title: "## S√≠ndromes Detectadas"
        content: |
          {syndromes_list_detailed}
      
      - section: hematimetric_patterns
        title: "## Padr√µes Hematim√©tricos"
        content: |
          {patterns_description}
          
          **S√©rie(s) afetada(s):** {affected_series}
      
      - section: evidences
        title: "## Evid√™ncias Disparadas"
        content: |
          {evidence_trail}
      
      - section: next_steps
        title: "## üî¨ Pr√≥ximos Passos Recomendados"
        content: |
          {next_steps_from_module_09}
          
          **Atualizar caso:** Ao receber resultados, sistema reconcilia automaticamente.
      
      - section: missing_keys
        title: "## Campos Ausentes (se aplic√°vel)"
        content: |
          {missing_fields_list}
          
          **Impacto:** {missing_impact}
      
      - section: differential_diagnosis
        title: "## Diagn√≥stico Diferencial (se aplic√°vel)"
        content: |
          {differential_diagnosis_list}
    
    footer: |
      ---
      **Repetir CBC:** Conforme orienta√ß√£o (geralmente 2-6 semanas se borderline)  
      **Timestamp:** {timestamp_utc}  
      **Route ID:** `{route_id}`
    
    render_options:
      highlight_color: "#FFA500"
      alert_sound: false
      notification: "standard"
  
  # ---------------------------------------------------------------------------
  # ROUTINE BORDERLINE CARD
  # ---------------------------------------------------------------------------
  routine_borderline:
    header: |
      # ‚ÑπÔ∏è ROTINA: Valores Borderline Detectados
      **Route ID:** `{route_id}`
    
    body_sections:
      - section: borderline_summary
        title: "## Valores Lim√≠trofes"
        content: |
          {borderline_values_table}
      
      - section: borderline_advice
        title: "## Orienta√ß√£o Cl√≠nica"
        content: |
          {borderline_advice_from_module_05}
          
          **Pr√≥ximos passos sugeridos:**
          {next_steps_from_module_09}
    
    footer: |
      ---
      **Repetir CBC:** 2-6 semanas para confirmar tend√™ncia  
      **Timestamp:** {timestamp_utc}
    
    render_options:
      highlight_color: "#00BFFF"
      alert_sound: false
      notification: "low_priority"
    
    # NOVO v2.3.1 ‚Äî Regras borderline (adulto + pedi√°trico)
    borderline_rules:
      adult:
        - "mcv in [80,82) or (98,100]"
        - "plt in [140,150) or (450,500]"
        - "wbc in [3.8,4) or (11,12]"
      
      # NOVO v2.3.1 ‚Äî Faixas pedi√°tricas
      pediatric:
        - "hb in [11,11.5)"
        - "mcv in [75,78)"
  
  # ---------------------------------------------------------------------------
  # ROUTINE NORMAL CARD
  # ---------------------------------------------------------------------------
  routine_normal:
    header: |
      # ‚úÖ ROTINA: Hemograma Sem Altera√ß√µes Significativas
      **Route ID:** `{route_id}`
    
    body_sections:
      - section: normal_ranges
        title: "## Valores Dentro da Normalidade"
        content: |
          **S√©rie Vermelha:**
          - Hb: {hb} g/dL (ref: {ref_hb})
          - MCV: {mcv} fL (ref: {ref_mcv})
          - RDW: {rdw}% (ref: {ref_rdw})
          
          **S√©rie Branca:**
          - WBC: {wbc} √ó10‚Åπ/L (ref: {ref_wbc})
          - ANC: {anc} √ó10‚Åπ/L (ref: {ref_anc})
          
          **S√©rie Plaquet√°ria:**
          - PLT: {plt} √ó10‚Åπ/L (ref: {ref_plt})
          - MPV: {mpv} fL (ref: {ref_mpv})
      
      - section: recommendations
        title: "## Recomenda√ß√µes"
        content: |
          - Nenhum exame adicional necess√°rio no momento
          - Repetir CBC conforme protocolo institucional ou cl√≠nica
          - Manter acompanhamento de rotina
    
    footer: |
      ---
      **Pr√≥ximo CBC:** Conforme protocolo (geralmente anual se assintom√°tico)  
      **Timestamp:** {timestamp_utc}
    
    render_options:
      highlight_color: "#00FF00"
      alert_sound: false
      notification: "none"
  
  # ---------------------------------------------------------------------------
  # ABSTAIN WITH GUIDANCE (C0)
  # ---------------------------------------------------------------------------
  abstain_with_guidance:
    header: |
      # ‚ö†Ô∏è ABSTEN√á√ÉO CONSCIENTE (C0): Dados Insuficientes
      **Route ID:** `{route_id}`
    
    body_sections:
      - section: missingness_summary
        title: "## Taxa de Campos Ausentes"
        content: |
          **Missing rate:** {missing_pct}%  
          **Threshold:** 30%
          
          **Campos cr√≠ticos faltantes:**
          {missing_fields_list_detailed}
      
      - section: available_data
        title: "## Dados Dispon√≠veis"
        content: |
          {available_fields_table}
      
      - section: proxy_logic_attempts
        title: "## Tentativas de Infer√™ncia (Proxy Logic)"
        content: |
          {proxy_logic_results}
      
      - section: next_steps_prioritized
        title: "## üî¨ Pr√≥ximos Passos Priorit√°rios"
        content: |
          {next_steps_from_module_09_with_cost_turnaround}
          
          **Atualizar caso:** Sistema reconcilia automaticamente ao receber resultados.
      
      - section: guidance
        title: "## Orienta√ß√£o Cl√≠nica"
        content: |
          Devido √† alta taxa de campos ausentes, o sistema optou por absten√ß√£o consciente (C0).
          
          **Pode prosseguir com cautela se:**
          - Contexto cl√≠nico permite espera segura
          - Exames priorit√°rios j√° solicitados
          
          **N√ÉO prosseguir se:**
          - Suspeita cl√≠nica de condi√ß√£o cr√≠tica (neutropenia, TMA, bl√°stica)
          - Sintomas graves (febre >38.5¬∞C, sangramento, fadiga extrema)
    
    footer: |
      ---
      **Importante:** Este √© um C0 **orientado**, n√£o um bloqueio.  
      Sistema SEMPRE fornece pr√≥ximos passos √∫teis.  
      **Timestamp:** {timestamp_utc}
    
    render_options:
      highlight_color: "#FFFF00"
      alert_sound: false
      notification: "standard"

# =============================================================================
# SE√á√ÉO 3: CONFIDENCE MAPPING (C0/C1/C2)
# =============================================================================
confidence_mapping:
  description: |
    Mapeia n√≠veis de confian√ßa com explica√ß√µes claras para o cl√≠nico.
    Integra com m√≥dulo 05 (missingness) e 03 (syndromes).
  
  levels:
    C0:
      name: "Inconclusivo"
      color: "#FFFF00"
      icon: "‚ö†Ô∏è"
      description: |
        **ABSTEN√á√ÉO CONSCIENTE:** Dados insuficientes para conclus√£o definitiva.
        
        **Causas comuns:**
        - >30% dos campos-chave ausentes para a s√≠ndrome suspeita
        - S√≠ndrome requer crit√©rio diagn√≥stico absoluto ausente (ex: HbA2 para beta-tal)
        - Ambiguidade cl√≠nica (ex: ferritina 30-100 sem TSat/CRP)
        
        **A√ß√£o recomendada:**
        - Solicitar exames priorit√°rios listados em "Pr√≥ximos Passos"
        - Atualizar caso ao receber resultados
        - N√ÉO ignorar se contexto cl√≠nico grave
      
      display_in_card: true
      requires_next_steps: true
      requires_missing_fields: true
    
    C1:
      name: "Evid√™ncia Parcial"
      color: "#FFA500"
      icon: "‚ö†Ô∏è"
      description: |
        **SUSPEITA FUNDADA:** Padr√£o cl√≠nico sugestivo, mas confirma√ß√£o recomendada.
        
        **Causas comuns:**
        - Padr√£o hematim√©trico t√≠pico presente (ex: microcitose + RDW alto = IDA prov√°vel)
        - Proxy logic inferiu com sucesso (ex: policromasia ‚Üí reticulocitose prov√°vel)
        - Missing <30% ou campos n√£o-diagn√≥sticos ausentes
        
        **A√ß√£o recomendada:**
        - Prosseguir com cautela
        - Solicitar exames confirmat√≥rios se dispon√≠vel (listados em "Pr√≥ximos Passos")
        - Repetir CBC conforme orienta√ß√£o
      
      display_in_card: true
      requires_next_steps: true
      requires_missing_fields: false
    
    C2:
      name: "Padr√£o Consistente"
      color: "#00FF00"
      icon: "‚úÖ"
      description: |
        **ALTA CONFIAN√áA:** Crit√©rios diagn√≥sticos preenchidos ou padr√£o cl√°ssico completo.
        
        **Causas comuns:**
        - Crit√©rio diagn√≥stico definitivo presente (ex: BCR-ABL+ = LMC)
        - Missing <10% e campos cr√≠ticos presentes
        - M√∫ltiplas evid√™ncias convergentes
        
        **A√ß√£o recomendada:**
        - Prosseguir conforme protocolo da s√≠ndrome
        - Pr√≥ximos passos listados s√£o complementares (n√£o obrigat√≥rios)
      
      display_in_card: true
      requires_next_steps: false
      requires_missing_fields: false
  
  calculation_logic: |
    # Pseudoc√≥digo para c√°lculo de confidence
    
    def compute_confidence(syndrome, missing_rate, proxy_logic_success):
        # 1. Casos especiais (crit√©rios absolutos)
        if syndrome in [S-BETA-THAL, S-APLASIA-RETIC-LOW, S-CIVD]:
            if missing_critical_field(syndrome):
                return "C0"
            else:
                return "C2"
        
        # 2. Missing rate alto
        if missing_rate > 0.30:
            return "C0"
        
        # 3. Proxy logic bem-sucedida
        if proxy_logic_success and missing_rate <= 0.30:
            return "C1"
        
        # 4. Missing rate baixo
        if missing_rate <= 0.10:
            return "C2"
        
        # 5. Default (missing 10-30%)
        return "C1"

# =============================================================================
# SE√á√ÉO 4: INTEGRA√á√ÉO COM NEXT_STEPS_ENGINE (M√ìDULO 09)
# =============================================================================
integration_next_steps_engine:
  description: |
    Output policies chama m√≥dulo 09 para listar pr√≥ximos passos priorizados.
    Render formata e insere no card final.
  
  workflow:
    1: "Output policies identifica s√≠ndromes + missing_keys"
    2: "Chama next_steps_engine.compute_next_steps(case)"
    3: "Recebe lista priorizada (0-8 exames)"
    4: "Formata em markdown/HTML"
    5: "Insere na se√ß√£o 'Pr√≥ximos Passos' do card"
  
  formatting:
    markdown: |
      ## üî¨ Pr√≥ximos Passos Recomendados
      
      {for item in next_steps_list:}
      ### {item.level_icon} {item.test}
      
      **Motivo:** {item.rationale}  
      **Custo:** {item.cost} | **Turnaround:** {item.turnaround}  
      **Pr√©-requisito:** {item.prereq}
      
      {endfor}
      
      ---
      **Atualizar caso:** Ao receber resultados, o sistema reconcilia automaticamente e recalcula s√≠ndromes.
    
    html: |
      <div class="next-steps-section">
        <h2>üî¨ Pr√≥ximos Passos Recomendados</h2>
        <ul class="next-steps-list">
          {for item in next_steps_list:}
          <li class="next-step-item level-{item.level}">
            <span class="test-name">{item.test}</span>
            <p class="rationale">{item.rationale}</p>
            <div class="metadata">
              <span class="cost cost-{item.cost}">{item.cost}</span>
              <span class="turnaround">{item.turnaround}</span>
              <span class="prereq">{item.prereq}</span>
            </div>
          </li>
          {endfor}
        </ul>
      </div>
    
    json: |
      {
        "next_steps": [
          {
            "level": "priority",
            "test": "Ferritina",
            "rationale": "Confirmar IDA (diagn√≥stico se <30 ng/mL)",
            "cost": "low",
            "turnaround": "fast",
            "prereq": "CBC"
          },
          ...
        ]
      }

# =============================================================================
# SE√á√ÉO 5: RENDER MULTI-FORMATO
# =============================================================================
render_formats:
  
  markdown:
    description: "Formato padr√£o para documenta√ß√£o e logs"
    mime_type: "text/markdown"
    extension: ".md"
    example: |
      # üö® CR√çTICO: S-TMA
      **Confidence:** C1 | **Route ID:** `sha256:abc123...`
      
      ## Evid√™ncias Disparadas
      - E-PLT-URGENT-LOW-30: PLT 25 √ó10‚Åπ/L
      - E-SCHISTOCYTES-PRESENT: Esquist√≥citos confirmados
      - E-LDH-HIGH: LDH 980 U/L
      
      ## ‚ö° A√ß√µes Urgentes Obrigat√≥rias
      1. Esfrega√ßo manual urgente
      2. PLASMIC score
      3. ADAMTS13 + Complemento
  
  html:
    description: "Para UI web (frontend HemoDoctor)"
    mime_type: "text/html"
    extension: ".html"
    css_classes:
      critical: "card-critical alert-urgent"
      priority: "card-priority alert-standard"
      routine: "card-routine"
      review_sample: "card-review-sample"
    example: |
      <div class="hemodoctor-card card-critical">
        <div class="card-header">
          <h1>üö® CR√çTICO: S-TMA</h1>
          <span class="confidence-badge">C1</span>
        </div>
        <div class="card-body">
          ...
        </div>
      </div>
  
  json:
    description: "Para APIs e integra√ß√£o com FHIR/HL7"
    mime_type: "application/json"
    extension: ".json"
    example: |
      {
        "card_type": "critical",
        "syndromes": ["S-TMA"],
        "confidence": "C1",
        "route_id": "sha256:abc123...",
        "evidences": [
          {"id": "E-PLT-URGENT-LOW-30", "value": 25, "unit": "√ó10‚Åπ/L"},
          {"id": "E-SCHISTOCYTES-PRESENT", "present": true}
        ],
        "actions": [
          {"priority": "critical", "action": "Esfrega√ßo manual urgente"},
          {"priority": "critical", "action": "PLASMIC score"}
        ],
        "next_steps": [
          {"level": "priority", "test": "ADAMTS13"}
        ]
      }
  
  fhir_r4:
    description: "Para interoperabilidade com sistemas FHIR"
    mime_type: "application/fhir+json"
    resource_type: "DiagnosticReport"
    example: |
      {
        "resourceType": "DiagnosticReport",
        "id": "hemodoctor-{case_id}",
        "status": "final",
        "category": [{
          "coding": [{
            "system": "http://terminology.hl7.org/CodeSystem/v2-0074",
            "code": "HM",
            "display": "Hematology"
          }]
        }],
        "code": {
          "coding": [{
            "system": "http://loinc.org",
            "code": "58410-2",
            "display": "CBC panel - Blood by Automated count"
          }]
        },
        "conclusion": "CRITICAL: S-TMA detected (C1 confidence)",
        "conclusionCode": [{
          "coding": [{
            "system": "http://snomed.info/sct",
            "code": "111293003",
            "display": "Thrombotic microangiopathy"
          }]
        }]
      }

# =============================================================================
# SE√á√ÉO 6: METADATA E AUDITORIA
# =============================================================================
metadata:
  version: "v2.3.0"
  module: "output_policies"
  dependencies:
    - "05_missingness_hybrid_v2.3.yaml"
    - "09_next_steps_engine_hybrid.yaml"
    - "06_route_policy_hybrid.yaml (opcional)"
  
  card_types_count: 6
  confidence_levels_count: 3
  render_formats_count: 4
  
  always_output_guarantee:
    description: "Sistema NUNCA retorna vazio"
    fallback_chain:
      1: "critical (se detectado)"
      2: "review_sample (se pr√©-anal√≠tico)"
      3: "priority (se padr√£o sugestivo)"
      4: "borderline (se lim√≠trofe)"
      5: "routine_normal (se normal)"
      6: "abstain_with_guidance (√∫ltimo fallback)"

validation:
  test_cases:
    - name: "TMA cr√≠tica (completa)"
      input: {plt: 25, esquistocitos: true, ldh: 980}
      expected_card: "critical"
      expected_confidence: "C2"
    
    - name: "IDA suspeita (sem ferritina)"
      input: {hb: 9.5, mcv: 72, rdw: 16}
      expected_card: "priority"
      expected_confidence: "C1"
    
    - name: "Borderline microcitose"
      input: {hb: 13.8, mcv: 81, rdw: 12}
      expected_card: "routine_borderline"
      expected_confidence: "N/A"
    
    - name: "CBC normal"
      input: {hb: 14.0, plt: 200, wbc: 7.0}
      expected_card: "routine_normal"
      expected_confidence: "N/A"
    
    - name: "Dados muito parciais"
      input: {hb: 9.0}
      expected_card: "abstain_with_guidance"
      expected_confidence: "C0"

notes: |
  - Output policies √© o maestro final do pipeline
  - SEMPRE gera card √∫til (6-level fallback)
  - Integra seamlessly com m√≥dulos 05 (missingness) e 09 (next_steps)
  - Confidence (C0/C1/C2) mapeado com explica√ß√µes claras
  - Suporta m√∫ltiplos formatos (markdown/HTML/JSON/FHIR)
  - WORM log (m√≥dulo 08) registra todo o card gerado para auditoria
  - Next steps sempre priorizados e formatados
  - Missing fields exibidos apenas se impactam decis√£o
  - Borderline sempre gera orienta√ß√£o de follow-up

# =============================================================================
# FIM DO ARQUIVO
# =============================================================================

