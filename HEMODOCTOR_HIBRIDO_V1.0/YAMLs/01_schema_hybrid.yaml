# 01_schema_hybrid.yaml
# Schema Canônico Híbrido - 41 campos V2.3.1
# Dev Team base + HemoDoctor LOINC + SADMH expansão futura
# Versão: v2.3.1
# Data: 2025-10-19

version: schema_hybrid_v2.3.1

# =============================================================================
# CAMPOS CBC CORE (15 campos - Dev Team base)
# =============================================================================
fields:
  - name: hb
    type: float
    unit: g/dL
    required: true
    loinc: "718-7"
    description: "Hemoglobina"
    physiological_range: [0, 25]
    
  - name: ht
    type: float
    unit: "%"
    required: false
    loinc: "4544-3"
    description: "Hematócrito"
    physiological_range: [0, 75]
    
  - name: rbc
    type: float
    unit: 1e12/L
    required: false
    loinc: "789-8"
    description: "Hemácias (Red Blood Cells)"
    physiological_range: [0, 10]
    
  - name: mcv
    type: float
    unit: fL
    required: true
    loinc: "787-2"
    description: "Volume Corpuscular Médio"
    physiological_range: [50, 150]
    
  - name: mch
    type: float
    unit: pg
    required: false
    derived: "(hb/rbc)*10"
    loinc: "785-6"
    description: "Hemoglobina Corpuscular Média"
    physiological_range: [15, 50]
    
  - name: mchc
    type: float
    unit: g/dL
    required: false
    derived: "(hb/ht)*100"
    loinc: "786-4"
    description: "Concentração de Hemoglobina Corpuscular Média"
    physiological_range: [25, 38]
    
  - name: rdw
    type: float
    unit: "%"
    required: false
    loinc: "788-0"
    description: "Red Cell Distribution Width (anisocitose)"
    physiological_range: [9, 20]
    
  - name: wbc
    type: float
    unit: 1e9/L
    required: true
    loinc: "6690-2"
    description: "Leucócitos (White Blood Cells)"
    physiological_range: [0, 200]
    
  - name: anc
    type: float
    unit: 1e9/L
    required: false
    derived: "wbc*(neut_pct/100)"
    loinc: "751-8"
    description: "Absolute Neutrophil Count"
    physiological_range: [0, 50]
    
  - name: lymphocytes_abs
    type: float
    unit: 1e9/L
    required: false
    loinc: "731-0"
    description: "Linfócitos absolutos"
    physiological_range: [0, 50]
    
  - name: eosinophils_abs
    type: float
    unit: 1e9/L
    required: false
    loinc: "711-2"
    description: "Eosinófilos absolutos"
    physiological_range: [0, 10]
    
  - name: basophils_abs
    type: float
    unit: 1e9/L
    required: false
    loinc: "704-7"
    description: "Basófilos absolutos"
    physiological_range: [0, 2]

  - name: monocytes_abs
    type: float
    unit: 1e9/L
    required: false
    loinc: "742-7"
    description: "Monócitos absolutos"
    physiological_range: [0, 10]

  - name: plt
    type: float
    unit: 1e9/L
    required: true
    loinc: "777-3"
    description: "Plaquetas"
    physiological_range: [0, 2000]
    
  - name: mpv
    type: float
    unit: fL
    required: false
    loinc: "32623-1"
    description: "Mean Platelet Volume"
    physiological_range: [5, 15]
    
  - name: reticulocytes
    type: float
    unit: 1e9/L
    required: false
    loinc: "4679-7"
    description: "Reticulócitos absolutos"
    physiological_range: [0, 500]

# =============================================================================
# COMPLEMENTARY TESTS (9 campos - Dev Team base)
# =============================================================================
  - name: ferritin
    type: float
    unit: ng/mL
    required: false
    loinc: "2276-4"
    description: "Ferritina sérica"
    physiological_range: [0, 10000]
    
  - name: tsat
    type: float
    unit: "%"
    required: false
    loinc: "2502-3"
    description: "Saturação de transferrina"
    physiological_range: [0, 100]
    
  - name: crp
    type: float
    unit: mg/L
    required: false
    loinc: "1988-5"
    description: "Proteína C Reativa"
    physiological_range: [0, 500]
    
  - name: ldh
    type: float
    unit: U/L
    required: false
    loinc: "2532-0"
    description: "Lactato Desidrogenase"
    physiological_range: [0, 5000]
    
  - name: bt_indireta
    type: float
    unit: mg/dL
    required: false
    loinc: "1968-7"
    description: "Bilirrubina Indireta"
    physiological_range: [0, 50]
    
  - name: haptoglobin
    type: float
    unit: mg/dL
    required: false
    loinc: "4542-7"
    description: "Haptoglobina"
    physiological_range: [0, 300]
    
  - name: b12
    type: float
    unit: pg/mL
    required: false
    loinc: "2132-9"
    description: "Vitamina B12"
    physiological_range: [0, 2000]
    
  - name: folate
    type: float
    unit: ng/mL
    required: false
    loinc: "2284-8"
    description: "Ácido Fólico"
    physiological_range: [0, 50]
    
  - name: hba2
    type: float
    unit: "%"
    required: false
    loinc: "4576-5"
    description: "Hemoglobina A2 (eletroforese)"
    physiological_range: [0, 10]
    
  # NOVO v2.3.1 — Eritropoietina sérica (opcional, para PV/eritrocitose)
  - name: epo
    type: float
    unit: mIU/mL
    required: false
    description: "Eritropoietina sérica (PV vs eritrocitose secundária)"
    physiological_range: [0, 200]
    clinical_note: "EPO baixa sugere PV; EPO alta sugere eritrocitose secundária"

# =============================================================================
# MOLECULARES (9 campos - Dev Team triestado)
# =============================================================================
  - name: coombs_pos
    type: tri_bool
    required: false
    description: "Coombs Direto positivo (hemólise autoimune)"
    values: [true, false, unknown]
    
  - name: bcr_abl_pos
    type: tri_bool
    required: false
    description: "BCR-ABL positivo (LMC screening)"
    values: [true, false, unknown]
    
  - name: jak2_pos
    type: tri_bool
    required: false
    description: "JAK2 V617F positivo (NMP driver mutation)"
    values: [true, false, unknown]
    
  - name: calr_pos
    type: tri_bool
    required: false
    description: "CALR mutação positiva (NMP driver mutation)"
    values: [true, false, unknown]
    
  - name: mpl_pos
    type: tri_bool
    required: false
    description: "MPL mutação positiva (NMP driver mutation)"
    values: [true, false, unknown]
    
  - name: hpn_pos
    type: tri_bool
    required: false
    description: "HPN (PNH) - CD55/CD59 deficientes"
    values: [true, false, unknown]
    
  - name: flc_ratio_abnormal
    type: tri_bool
    required: false
    description: "Free Light Chains ratio anormal (mieloma)"
    values: [true, false, unknown]
    
  - name: g6pd_deficient
    type: tri_bool
    required: false
    description: "G6PD deficiente (enzimopatia - hemólise oxidativa)"
    values: [true, false, unknown]
    
  - name: pk_deficient
    type: tri_bool
    required: false
    description: "Piruvato Quinase deficiente (enzimopatia)"
    values: [true, false, unknown]

# =============================================================================
# MORFOLOGIA TRIESTADO (17 tokens - Dev Team INOVAÇÃO)
# =============================================================================
morphology_tokens:
  - name: esquistocitos
    type: tri_bool
    required: false
    description: "Esquistócitos (fragmentócitos) ≥1% = TMA concern"
    clinical_significance: "TMA/MAT (≥1% crítico)"
    values: [true, false, unknown]
    
  - name: esferocitos
    type: tri_bool
    required: false
    description: "Esferócitos"
    clinical_significance: "Esferocitose hereditária, hemólise autoimune"
    values: [true, false, unknown]
    
  - name: dacriocitos
    type: tri_bool
    required: false
    description: "Dacrócitos (tear drops)"
    clinical_significance: "Mielofibrose, talassemia"
    values: [true, false, unknown]
    
  - name: eliptocitos
    type: tri_bool
    required: false
    description: "Eliptócitos"
    clinical_significance: "Eliptocitose hereditária, IDA"
    values: [true, false, unknown]
    
  - name: drepanocitos
    type: tri_bool
    required: false
    description: "Drepanócitos (sickle cells)"
    clinical_significance: "Doença falciforme"
    values: [true, false, unknown]
    
  - name: rouleaux
    type: tri_bool
    required: false
    description: "Rouleaux (hemácias empilhadas)"
    clinical_significance: "Mieloma, inflamação"
    values: [true, false, unknown]
    
  - name: policromasia
    type: tri_bool
    required: false
    description: "Policromasia (reticulocitose morfológica)"
    clinical_significance: "Reticulocitose (hemólise, sangramento)"
    values: [true, false, unknown]
    
  - name: corpos_howell_jolly
    type: tri_bool
    required: false
    description: "Corpúsculos de Howell-Jolly"
    clinical_significance: "Asplenia/hipoesplenismo"
    values: [true, false, unknown]
    
  - name: blastos
    type: tri_bool
    required: false
    description: "Blastos"
    clinical_significance: "Leucemia aguda, SMD high-grade"
    values: [true, false, unknown]
    
  - name: promielocitos
    type: tri_bool
    required: false
    description: "Promielócitos"
    clinical_significance: "LPA (M3), reação leucemoide"
    values: [true, false, unknown]
    
  - name: mielocitos
    type: tri_bool
    required: false
    description: "Mielócitos"
    clinical_significance: "LMC, reação leucemoide"
    values: [true, false, unknown]
    
  - name: metamielocitos
    type: tri_bool
    required: false
    description: "Metamielócitos"
    clinical_significance: "LMC, reação leucemoide"
    values: [true, false, unknown]
    
  - name: bastoes
    type: tri_bool
    required: false
    description: "Bastonetes (bandemia)"
    clinical_significance: "Infecção, inflamação"
    values: [true, false, unknown]
    
  - name: linfocitos_atipicos
    type: tri_bool
    required: false
    description: "Linfócitos atípicos"
    clinical_significance: "Viral (EBV, CMV)"
    values: [true, false, unknown]
    
  - name: hiposegmentacao
    type: tri_bool
    required: false
    description: "Hiposegmentação (Pelger-Huët)"
    clinical_significance: "Pelger-Huët, SMD"
    values: [true, false, unknown]
    
  - name: aglomerados_plaquetarios
    type: tri_bool
    required: false
    description: "Aglomerados plaquetários (clumps)"
    clinical_significance: "Pseudo-trombocitopenia"
    values: [true, false, unknown]
    
  - name: plaquetas_gigantes
    type: tri_bool
    required: false
    description: "Plaquetas gigantes"
    clinical_significance: "NMP, Bernard-Soulier"
    values: [true, false, unknown]

# =============================================================================
# METADATA (2 campos - Dev Team fairness by design)
# =============================================================================
  - name: age_years
    type: float
    required: true
    description: "Idade em anos"
    physiological_range: [0, 120]
    
  - name: sex
    type: enum
    required: true
    description: "Sexo biológico"
    values: ["M", "F", "Unknown"]

# =============================================================================
# SINÔNIMOS MORFOLOGIA (PT-BR → token canônico)
# =============================================================================
morphology_synonyms:
  esquistocitos: ["esquisto", "fragmentócitos", "fragmentados", "helmet cells"]
  bastoes: ["bastonetes", "bandemia", "neutrófilos em banda"]
  aglomerados_plaquetarios: ["clumps", "agregados de plaquetas", "satelitismo plaquetário"]
  policromasia: ["reticulocitose morfológica", "policromatofilia"]
  hiposegmentacao: ["Pelger-Huët", "pseudo-Pelger"]
  drepanocitos: ["células falciformes", "sickle cells"]
  corpos_howell_jolly: ["corpúsculos de Howell-Jolly", "Howell-Jolly"]

# =============================================================================
# VALIDAÇÃO (HemoDoctor + Dev Team)
# =============================================================================
validation_rules:
  - field: hb
    rule: "value >= 0 and value <= 25"
    error_message: "Hb fora da faixa fisiológica (0-25 g/dL)"
    
  - field: mcv
    rule: "value >= 50 and value <= 150"
    error_message: "MCV fora da faixa fisiológica (50-150 fL)"
    
  - field: plt
    rule: "value >= 0 and value <= 2000"
    error_message: "PLT fora da faixa fisiológica (0-2000 1e9/L)"
    
  - field: wbc
    rule: "value >= 0 and value <= 200"
    error_message: "WBC fora da faixa fisiológica (0-200 1e9/L)"
    
  - field: mchc
    rule: "value >= 25 and value <= 38"
    error_message: "MCHC impossível (25-38 g/dL); suspeita de erro pré-analítico"
    action: "review_sample"

# =============================================================================
# EXPANSÃO FUTURA (V1.1/V1.2 - SADMH)
# =============================================================================
future_fields_v1_1:
  # Bone Marrow (7 campos)
  - blastos_medula
  - celularidade
  - fibrose
  - displasia
  - sideroblastos_anelados
  - cd34_pct
  - cariotipo

future_fields_v1_2:
  # Coagulation (11 campos)
  - pt
  - aptt
  - fibrinogenio
  - d_dimer
  - fator_viii
  - vwf
  - antitrombina
  - proteina_c
  - proteina_s
  - fibrinolise
  - tromboelastografia

# =============================================================================
# FIM DO ARQUIVO
# =============================================================================

